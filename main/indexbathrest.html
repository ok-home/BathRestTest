<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<style>
		body {
			font-family: Arial;
		}

		/* Style the tab */
		.tab {
			overflow: hidden;
			border: 1px solid #ccc;
			background-color: #f1f1f1;
		}

		/* Style the buttons inside the tab */
		.tab button {
			background-color: inherit;
			float: left;
			border: none;
			outline: none;
			cursor: pointer;
			padding: 14px 16px;
			transition: 0.3s;
			font-size: 17px;
		}

		/* Change background color of buttons on hover */
		.tab button:hover {
			background-color: #ddd;
		}

		/* Create an active/current tablink class */
		.tab button.active {
			background-color: #ccc;
		}

		/* Style the tab content */
		.tabcontent {
			display: none;
			padding: 14px 28px;
			border: 1px solid #ccc;
			border-top: none;
		}

		/* Style inputs with type="text", select elements and textareas */
		input[type=text],
		input[type=file],
		select,
		textarea {
			width: 100%;
			/* Full width */
			font-size: 16px;
			padding: 14px 28px;
			/* Some padding */
			border: 1px solid #ccc;
			/* Gray border */
			border-radius: 4px;
			/* Rounded borders */
			box-sizing: border-box;
			/* Make sure that padding and width stays in place */
			margin-top: 6px;
			/* Add a top margin */
			margin-bottom: 16px;
			/* Bottom margin */
			resize: vertical
				/* Allow the user to vertically resize the textarea (not horizontally) */
		}

		.btn {
			border: none;
			color: white;
			padding: 14px 28px;
			font-size: 16px;
			cursor: pointer;
		}

		.default {
			background-color: #e7e7e7;
			color: black;
		}

		/* Gray */
		.default:hover {
			background: #ddd;
		}
	</style>

</head>

<body>
	<div class="tab">
		<button class="tablinks" onclick="openTab(event, 'Data')" id="defaultOpenTab">Данные</button>
		<button class="tablinks" onclick="openTab(event, 'Param')">Параметры</button>
		<button class="tablinks" onclick="openTab(event, 'OTA')">Обновление</button>
		<button class="tablinks" onclick="openTab(event, 'WiFi')">Подключение</button>
	</div>

	<div id="Data" class="tabcontent">
		<table border="1" cellpadding="1" cellspacing="1" id="CtrlData" style="width: 500px">
			<tbody>
				<tr>
					<td colspan="2" style="text-align: center;">Данные Датчиков</td>
				</tr>
				<tr>
					<td style="text-align: center;">Температура</td>
					<td>
						<div id="TempVol" style="text-align: center;"></div>
					</td>
				</tr>
				<tr>
					<td style="text-align: center;">Влажность</td>
					<td>
						<div id="HumVol" style="text-align: center;"></div>
					</td>
				</tr>
				<tr>
					<td style="text-align: center;">Расстояние</td>
					<td>
						<div id="DistVol" style="text-align: center;"></div>
					</td>
				</tr>
				<tr>
					<td style="text-align: center;">Ик Датчик Движения</td>
					<td>
						<div id="IrVol" style="text-align: center;"></div>
					</td>
				</tr>
				<tr>
					<td style="text-align: center;">Мв Датчик Движения</td>
					<td>
						<div id="MvVol" style="text-align: center;"></div>
					</td>
				</tr>
				<tr>
					<td colspan="2" style="text-align: center;">
						<div id="EchoString" style="text-align: center;"></div>
					</td>
				</tr>
			</tbody>
		</table>
		<form action="DisplayStatus" enctype="text/plain" id="Status" method="get" name="StatusForm">&nbsp;
			<table border="1" cellpadding="1" cellspacing="1" style="width: 500px">
				<tbody>
					<tr>
						<td>&nbsp;</td>
						<td style="text-align: center;">Состояние</td>
						<td>
							<p align="center">Разрешить</p>
							<p align="center">Автомат</p>
						</td>
						<td style="text-align: center;">Ручное включение</td>
					</tr>
					<tr>
						<td>Свет Ванная</td>
						<td>
							<div id="BathLightStatus" style="text-align: center;"> </div>
						</td>
						<td style="text-align: center;"><input checked="checked" name="BathLightAutoEnable"
								type="checkbox" value="On">&nbsp;Разрешить</td>
						<td style="text-align: center;"><input checked="checked" name="BathLightOnOff" type="checkbox"
								value="On">&nbsp;Вкл/Выкл</td>
					</tr>
					<tr>
						<td>Свет Туалет</td>
						<td>
							<div id="RestLightStatus" style="text-align: center;"> </div>
						</td>
						<td style="text-align: center;"><input checked="checked" name="RestLightAutoEnable"
								type="checkbox" value="On">&nbsp;Разрешить</td>
						<td style="text-align: center;"><input checked="checked" name="RestLightOnOff" type="checkbox"
								value="On">&nbsp;Вкл/Выкл</td>
					</tr>
					<tr>
						<td>Вентиляция Ванная</td>
						<td>
							<div id="BathVentStatus" style="text-align: center;"> </div>
						</td>
						<td style="text-align: center;"><input checked="checked" name="BathVentAutoEnable"
								type="checkbox" value="On">&nbsp;Разрешить</td>
						<td style="text-align: center;"><input checked="checked" name="BathVentOnOff" type="checkbox"
								value="On">&nbsp;Вкл/Выкл</td>
					</tr>
					<tr>
						<td>Вентиляция Туалет</td>
						<td>
							<div id="RestVentStatus" style="text-align: center;"> </div>
						</td>
						<td style="text-align: center;"><input checked="checked" name="RestVentAutoEnable"
								type="checkbox" value="On">&nbsp;Разрешить</td>
						<td style="text-align: center;"><input checked="checked" name="RestVentOnOff" type="checkbox"
								value="On">&nbsp;Вкл/Выкл</td>
					</tr>
				</tbody>
			</table>
		</form>
	</div>
	<div id="Param" class="tabcontent">
		<form action="AutoSetForm" enctype="text/plain" id="AutoSetId" method="get" name="AutoSetForm">&nbsp;
			<table border="1" cellpadding="1" cellspacing="1" style="width:500px">
				<tbody>
					<tr>
						<td colspan="3" style="text-align:center">Настройка параметров</td>
					</tr>
					<tr>
						<td>Вентиляция Ванна Влажность</td>
						<td colspan="2" rowspan="1" style="text-align:center"><input checked="checked"
								name="BathVentUseHum" type="checkbox" />&nbsp;Разрешить</td>
					</tr>
					<tr>
						<td>Вентиляция Ванна Влажность Параметры</td>
						<td style="text-align:center">Включение &gt;&nbsp;<input name="BathHumOnParm" type="text"
								value="70" required pattern="[0-9]{2}" /></td>
						<td style="text-align:center">Выключение &lt;<input name="BathHumOffParm" type="text"
								value="50" />
						</td>
					</tr>
					<tr>
						<td>Вентиляция Ванна Присутствие</td>
						<td colspan="2" rowspan="1" style="text-align:center"><input checked="checked"
								name="BathVentUseMove" type="checkbox" />&nbsp;Разрешить</td>
					</tr>
					<tr>
						<td>Вентиляция Ванна Присутствие Параметры</td>
						<td style="text-align:center">Задержка Включения<input name="BathVentOnDelay" type="text"
								value="0" /></td>
						<td style="text-align:center">Задержка выключения<input name="BathVentOffDelay" type="text"
								value="120" /></td>
					</tr>
					<tr>
						<td colspan="3" style="text-align:center">&nbsp;</td>
					</tr>
					<tr>
						<td>Свет Ванна ИК датчик</td>
						<td colspan="2" rowspan="1" style="text-align:center"><input checked="checked"
								name="BathLightIrUse" type="checkbox" />&nbsp;Разрешить</td>
					</tr>
					<tr>
						<td>Свет Ванна МВ Датчик</td>
						<td colspan="2" rowspan="1" style="text-align:center"><input checked="checked"
								name="BathLightMvUse" type="checkbox" />&nbsp;Разрешить</td>
					</tr>
					<tr>
						<td>Свет Ванна Параметры</td>
						<td style="text-align:center">Задержка включения<input name="BathLightOnDelay" type="text"
								value="10" /></td>
						<td style="text-align:center">Задержка Выключения<input name="BathLightOffDelay" type="text"
								value="120" /></td>
					</tr>
					<tr>
						<td colspan="3" style="text-align:center">&nbsp;</td>
					</tr>
					<tr>
						<td>Свет Туалет Параметры</td>
						<td style="text-align:center">Расстояние Включения<input name="RestLightOnDist" type="text"
								value="200" /></td>
						<td style="text-align:center">Расстояние Выключения<input name="RestLightOffDist" type="text"
								value="250" /></td>
					</tr>
					<tr>
						<td>Вентиляция Туалет Параметры</td>
						<td style="text-align:center">Задержка включения<input name="RestVentOnDelay" type="text"
								value="30" /></td>
						<td style="text-align:center">Задержка Выключения<input name="RestVentOffDelay" type="text"
								value="120" /></td>
					</tr>
				</tbody>
			</table>
		</form>
		<button class="btn default" id="WriteDataParm">Сохранить параметры</button>

	</div>
	</div>
	<div id="OTA" class="tabcontent">
		<h3>Выберите файл обновления</h3>
		<div id="OtaString"></div>
		<input type="file" id="files" name="file" />
		<button class="btn default" id="OTA_start">Обновить ПО</button>
	</div>

	<div id="WiFi" class="tabcontent">
		<h3>Подключение WiFi</h3>
		<label for="WiFi_SSID">Имя сети</label>
		<input type="text" id="WiFi_SSID" name="wifi_ssid" placeholder="SSID..">
		<label for="WiFi_Pass">Пароль</label>
		<input type="text" id="WiFi_Pass" name="wifi_pass" placeholder="Pass..">
		<label for="WiFi_STA_AP">Режим при загрузке</label>
		<select id="WiFi_STA_AP" name="wifi_sta_ap">
			<option value="wifi_sta">Подключение к сети</option>
			<option value="wifi_ap">Точка доступа BathRestWifi_AP 192.168.4.1</BathRestWifi_AP>
			</option>
		</select>
		<button class="btn default" id="Wifi_Upload">Записать данные WiFi </button>
		<button class="btn default" id="Wifi_Restart">Рестарт</button>
	</div>

	<script id="worker1" type="javascript/worker">

		var wsHost = 0;
		self.onmessage = function(e) {

		if(wsHost == 0)
		{
		if(e.data.indexOf("ws") != -1)
			{
			wsHost = e.data;	
			}
			return;
		}

		var otasocket = new WebSocket(wsHost);
		//var otasocket = new WebSocket("ws://echo.websocket.org");

		otasocket.binaryType = 'blob';

		var file = e.data;
		var size = file.size;
		var reader = new FileReaderSync();
		var start;
		var end;
		var offset = 1024;
		var data =  new Uint8Array(offset);

		otasocket.onopen = function () {
			console.log( " ota cоединение установлено");
			otasocket.send("start");
			
		}
		otasocket.onclose = function (event) {
			console.log( " ota cоединение закрыто");
			if (end == size)
				postMessage("transfer END - Restart");
			else
				postMessage("transfer ABORTED - ERROR");

		}
		otasocket.onerror = function (event) {
				console.log("ошибка " + event.message);
			};
				
		otasocket.onmessage = function (event) {
				//console.log(event.data);

				switch(event.data){
				case "err":
					postMessage("transfer ERR");
					otasocket.close();
					break;
				case "end":
					postMessage("transfer end");
					otasocket.close();
					break;
				case "start":
					postMessage("transfer start");
					start = 0;
					end = start+offset;
					if ( end > size )
						end = size;
					blob = file.slice(start,end);
					//data = reader.readAsBinaryString(blob);
					data = reader.readAsArrayBuffer(blob);
					postMessage("transfer from "+start+" to "+end);
					otasocket.send(data);
					break;
				case "next":
				//default :
					if(end == size)
					{
						otasocket.send("end");
						break;
					}
					start = end;
					end = start+offset;
					if ( end > size )
					end = size;
					blob = file.slice(start,end);
					//data = reader.readAsBinaryString(blob);
					data = reader.readAsArrayBuffer(blob);
					postMessage("transfer from "+start+" to "+end );
					otasocket.send(data);
			}
			}
		  };
	</script>

	<script>

		var bb = new Blob([document.querySelector('#worker1').textContent]);
		var worker = new Worker(window.webkitURL.createObjectURL(bb));
		var otastr = document.getElementById("OtaString");

		worker.postMessage("ws://" + document.location.host + "/otaws");

		worker.onmessage = function (e) {
			//console.log("Received: " + e.data);
			otastr.innerHTML = e.data;
		}

		const fileSelector = document.getElementById('files');
		var fileList;
		fileSelector.addEventListener('change', (event) => {
			fileList = event.target.files;
			//	worker.postMessage(fileList[0]); // Start the worker.
		});
		document.getElementById("OTA_start").addEventListener("click", function (e) {
			if (fileList !== undefined) {
				if (fileList[0] !== undefined) {
					otastr.innerHTML = "Обновление начато";
					worker.postMessage(fileList[0]);
					//fileList = 0;
				}
				else {
					otastr.innerHTML = "Файл обновления не выбран";
				}
			}
			else {
				otastr.innerHTML = "Файл обновления не выбран";
			}
		});



		/*--------------------------------------------------------------*/

		/*data range*/
		MaxHum = 90;
		MinHum = 10;
		MaxDelay = 300;
		MinDelay = 0;
		MaxDistance = 400;
		MinDistance = 50;

		EnableHandOnOff();
		EnableInputParm();
		var wsHostStr = "ws://" + document.location.host + "/ws"
		window.onload = function () {
			//var otasocket = new WebSocket("ws://echo.websocket.org");
			//var socket = new WebSocket("ws://192.168.1.61/ws");
			var socket = new WebSocket(wsHostStr);
			var status = document.getElementById("EchoString");

			socket.onopen = function () {
				status.innerHTML = "cоединение установлено";
				socket.send("sstrt");
			};

			socket.onclose = function (event) {
				if (event.wasClean) {
					status.innerHTML = 'cоединение закрыто';
				} else {
					status.innerHTML = 'соединения как-то закрыто';
				}
				status.innerHTML += ' код: ' + event.code + ' причина: ' + event.reason;
			};

			/*чтение данных сокета с сервера*/

			socket.onmessage = function (event) {
				let message = JSON.parse(event.data);
				status.innerHTML = `пришли данные: <b>${message.name}</b>: ${message.msg}`;
				/*
			  /* Инликация включения света и вентиляции ( пока в режиме эхо), 
			  /*в дальнейшем заменить Case переменные"
			  */
				switch (message.name) {
					/* показать состояние включения света и вентиляции */
					case "BathLightStatus":
						if (message.msg == true) document.getElementById("BathLightStatus").innerHTML = "Вкл";
						else document.getElementById("BathLightStatus").innerHTML = "Выкл";
						break;
					case "RestLightStatus":
						if (message.msg == true) document.getElementById("RestLightStatus").innerHTML = "Вкл";
						else document.getElementById("RestLightStatus").innerHTML = "Выкл";
						break;
					case "BathVentStatus":
						if (message.msg == true) document.getElementById("BathVentStatus").innerHTML = "Вкл";
						else document.getElementById("BathVentStatus").innerHTML = "Выкл";
						break;
					case "RestVentStatus":
						if (message.msg == true) document.getElementById("RestVentStatus").innerHTML = "Вкл";
						else document.getElementById("RestVentStatus").innerHTML = "Выкл";
						break;
					/* показать состояние датчиков */
					case "TempVol":
					case "HumVol":
					case "DistVol":
						document.getElementById(message.name).innerHTML = message.msg;
						break;
					case "IrVol":
					case "MvVol":
						if (message.msg == true) message.msg = "Вкл"; else message.msg = "Выкл";
						document.getElementById(message.name).innerHTML = message.msg;
						break;

					/* Status FormField */
					case "BathLightAutoEnable":
					case "RestLightAutoEnable":
					case "RestVentAutoEnable":
					case "BathVentAutoEnable":
					case "BathLightOnOff":
					case "RestLightOnOff":
					case "BathVentOnOff":
					case "RestVentOnOff":
						document.StatusForm.elements[message.name].checked = message.msg;
						EnableHandOnOff();
						break;

					/*Data Sw Autoset Forms*/
					case "BathVentUseHum":
					case "BathVentUseMove":
					case "BathLightIrUse":
					case "BathLightMvUse":
						document.AutoSetForm.elements[message.name].checked = message.msg;
						EnableInputParm();
						break;

					/*Data Param Autoset Form */
					case "BathHumOnParm":
					case "BathHumOffParm":
					case "BathVentOnDelay":
					case "BathVentOffDelay":
					case "BathLightOnDelay":
					case "BathLightOffDelay":
					case "RestLightOnDist":
					case "RestLightOffDist":
					case "RestVentOnDelay":
					case "RestVentOffDelay":
						document.AutoSetForm.elements[message.name].value = message.msg;
						break;
					case "wifi_ssid":
						document.getElementById("WiFi_SSID").value = message.msg;
						break;
					case "wifi_pass":
						document.getElementById("WiFi_Pass").value = message.msg;
						break;
					case "wifi_sta_ap":
						document.getElementById("WiFi_STA_AP").value = message.msg;
						break;
				}

			};

			socket.onerror = function (event) {
				status.innerHTML = "ошибка " + event.message;
			};

			/*Отправить параметры поля CheckBox в формате Json*/
			function SendPairCheckBox(e) {
				socket.send(JSON.stringify({ name: e.target.name, msg: e.target.checked }));
				return false;
			}

			/*Отправить параметры поля InputText в формате Json*/
			function SendPairInputData(e) {
				socket.send(JSON.stringify({ name: e.target.name, msg: e.target.value }));
				return false;
			}

			/* Обработчик CheckBox */
			/*StatusForm CheckBox*/
			document.StatusForm.BathLightAutoEnable.addEventListener("click", function (e) {
				EnableHandOnOff();
				SendPairCheckBox(e)
			});
			document.StatusForm.BathLightOnOff.addEventListener("click", function (e) { SendPairCheckBox(e) });
			document.StatusForm.RestLightAutoEnable.addEventListener("click", function (e) {
				EnableHandOnOff();
				SendPairCheckBox(e)
			});
			document.StatusForm.RestLightOnOff.addEventListener("click", function (e) { SendPairCheckBox(e) });
			document.StatusForm.BathVentAutoEnable.addEventListener("click", function (e) {
				EnableHandOnOff();
				SendPairCheckBox(e)
			});
			document.StatusForm.BathVentOnOff.addEventListener("click", function (e) { SendPairCheckBox(e) });
			document.StatusForm.RestVentAutoEnable.addEventListener("click", function (e) {
				EnableHandOnOff();
				SendPairCheckBox(e)
			});
			document.StatusForm.RestVentOnOff.addEventListener("click", function (e) { SendPairCheckBox(e) });

			/* AutoSetForm CheckBox*/
			document.AutoSetForm.BathVentUseHum.addEventListener("click", function (e) {
				EnableInputParm();
				SendPairCheckBox(e)
			});
			document.AutoSetForm.BathVentUseMove.addEventListener("click", function (e) {
				EnableInputParm();
				SendPairCheckBox(e)
			});
			document.AutoSetForm.BathLightIrUse.addEventListener("click", function (e) { SendPairCheckBox(e) });
			document.AutoSetForm.BathLightMvUse.addEventListener("click", function (e) { SendPairCheckBox(e) });

			/* Обработчик InputFields */
			/*AutoSetForm input field */
			document.AutoSetForm.BathHumOnParm.addEventListener("change", function (e) {
				if (e.target.value > MinHum && e.target.value < MaxHum)
					SendPairInputData(e);
				else {
					e.target.value = "Интервал " + MinHum + "-" + MaxHum;
					e.target.focus();
				}
			});
			document.AutoSetForm.BathHumOffParm.addEventListener("change", function (e) {
				if (e.target.value > MinHum && e.target.value < MaxHum)
					SendPairInputData(e);
				else {
					e.target.value = "Интервал " + MinHum + "-" + MaxHum;
					e.target.focus();
				}
			});
			document.AutoSetForm.BathVentOnDelay.addEventListener("change", function (e) {
				if (e.target.value > MinDelay && e.target.value < MaxDelay)
					SendPairInputData(e);
				else {
					e.target.value = "Интервал " + MinDelay + "-" + MaxDelay;
					e.target.focus();
				}
			});
			document.AutoSetForm.BathVentOffDelay.addEventListener("change", function (e) {
				if (e.target.value > MinDelay && e.target.value < MaxDelay)
					SendPairInputData(e);
				else {
					e.target.value = "Интервал " + MinDelay + "-" + MaxDelay;
					e.target.focus();
				}
			});
			document.AutoSetForm.BathLightOnDelay.addEventListener("change", function (e) {
				if (e.target.value > MinDelay && e.target.value < MaxDelay)
					SendPairInputData(e);
				else {
					e.target.value = "Интервал " + MinDelay + "-" + MaxDelay;
					e.target.focus();
				}
			});
			document.AutoSetForm.BathLightOffDelay.addEventListener("change", function (e) {
				if (e.target.value > MinDelay && e.target.value < MaxDelay)
					SendPairInputData(e);
				else {
					e.target.value = "Интервал " + MinDelay + "-" + MaxDelay;
					e.target.focus();
				}
			});
			document.AutoSetForm.RestLightOnDist.addEventListener("change", function (e) {
				if (e.target.value > MinDistance && e.target.value < MaxDistance)
					SendPairInputData(e);
				else {
					e.target.value = "Интервал " + MinDistance + "-" + MaxDistance;
					e.target.focus();
				}
			});
			document.AutoSetForm.RestLightOffDist.addEventListener("change", function (e) {
				if (e.target.value > MinDistance && e.target.value < MaxDistance)
					SendPairInputData(e);
				else {
					e.target.value = "Интервал " + MinDistance + "-" + MaxDistance;
					e.target.focus();
				}
			});
			document.AutoSetForm.RestVentOnDelay.addEventListener("change", function (e) {
				if (e.target.value > MinDelay && e.target.value < MaxDelay)
					SendPairInputData(e);
				else {
					e.target.value = "Интервал " + MinDelay + "-" + MaxDelay;
					e.target.focus();
				}
			});
			document.AutoSetForm.RestVentOffDelay.addEventListener("change", function (e) {
				if (e.target.value > MinDelay && e.target.value < MaxDelay)
					SendPairInputData(e);
				else {
					e.target.value = "Интервал " + MinDelay + "-" + MaxDelay;
					e.target.focus();
				}
			});
			/*********************/
			function check_Wifi_SSID_Pass() {
				var ssid = document.getElementById("WiFi_SSID");
				if (ssid.value.length == 0) {
					ssid.placeholder = "не может быть пустым";
					ssid.focus();
					return false;
				}

				var pass = document.getElementById("WiFi_Pass");
				if (pass.value.length < 8) {
					pass.value = "";
					pass.placeholder = "Пароль должен быть больше 8 символов";
					pass.focus();
					return false;
				}
				return true;
			}

			document.getElementById("WiFi_SSID").addEventListener("change", function (e) {
				if (e.target.value.length == 0) {
					e.target.placeholder = "не может быть пустым";
					e.target.focus();
				}
			});
			document.getElementById("WiFi_Pass").addEventListener("change", function (e) {
				if (e.target.value.length < 8) {
					e.target.value = '';
					e.target.placeholder = "Пароль должен быть больше 8 символов";
					e.target.focus();
				}
			});
			document.getElementById("Wifi_Restart").addEventListener("click", function (e) {
				var ssid = document.getElementById("WiFi_SSID");
				var pass = document.getElementById("WiFi_Pass");
				var sta_ap = document.getElementById("WiFi_STA_AP");
				if (check_Wifi_SSID_Pass()) {
					socket.send(JSON.stringify({ name: ssid.name, msg: ssid.value }));
					socket.send(JSON.stringify({ name: pass.name, msg: pass.value }));
					socket.send(JSON.stringify({ name: sta_ap.name, msg: sta_ap.value }));
					socket.send(JSON.stringify({ name: "Wifi_Restart", msg: "true" }));
				}

			});
			document.getElementById("Wifi_Upload").addEventListener("click", function (e) {
				var ssid = document.getElementById("WiFi_SSID");
				var pass = document.getElementById("WiFi_Pass");
				var sta_ap = document.getElementById("WiFi_STA_AP");
				if (check_Wifi_SSID_Pass()) {
					socket.send(JSON.stringify({ name: ssid.name, msg: ssid.value }));
					socket.send(JSON.stringify({ name: pass.name, msg: pass.value }));
					socket.send(JSON.stringify({ name: sta_ap.name, msg: sta_ap.value }));
					socket.send(JSON.stringify({ name: "Wifi_Restart", msg: "false" }));
				}
			});
			document.getElementById("WriteDataParm").addEventListener("click", function (e) {
				socket.send(JSON.stringify({ name: "WriteDatаParm", msg: "false" }));
				console.log("WriteDataParm");
			});

			/*********************/
		}
		/* 
		/*инициализация формы разрешение ручного включения света и вентиляции
		/*установка / снятие разрешения ручного ввода
		*/
		function EnableHandOnOff() {
			if (document.StatusForm.BathLightAutoEnable.checked == true) document.StatusForm.BathLightOnOff.disabled = true;
			else document.StatusForm.BathLightOnOff.disabled = false;
			if (document.StatusForm.RestLightAutoEnable.checked == true) document.StatusForm.RestLightOnOff.disabled = true;
			else document.StatusForm.RestLightOnOff.disabled = false;
			if (document.StatusForm.BathVentAutoEnable.checked == true) document.StatusForm.BathVentOnOff.disabled = true;
			else document.StatusForm.BathVentOnOff.disabled = false;
			if (document.StatusForm.RestVentAutoEnable.checked == true) document.StatusForm.RestVentOnOff.disabled = true;
			else document.StatusForm.RestVentOnOff.disabled = false;
		}

		function EnableInputParm() {
			if (document.AutoSetForm.BathVentUseHum.checked == true) {
				document.AutoSetForm.BathHumOnParm.disabled = false;
				document.AutoSetForm.BathHumOffParm.disabled = false;
			} else {
				document.AutoSetForm.BathHumOnParm.disabled = true;
				document.AutoSetForm.BathHumOffParm.disabled = true;
			};
			if (document.AutoSetForm.BathVentUseMove.checked == true) {
				document.AutoSetForm.BathVentOnDelay.disabled = false;
				document.AutoSetForm.BathVentOffDelay.disabled = false;
			} else {
				document.AutoSetForm.BathVentOnDelay.disabled = true;
				document.AutoSetForm.BathVentOffDelay.disabled = true;
			};

		}
		/*-------------------------------------------------*/
		function openTab(evt, tabName) {
			var i, tabcontent, tablinks;
			tabcontent = document.getElementsByClassName("tabcontent");
			for (i = 0; i < tabcontent.length; i++) {
				tabcontent[i].style.display = "none";
			}
			tablinks = document.getElementsByClassName("tablinks");
			for (i = 0; i < tablinks.length; i++) {
				tablinks[i].className = tablinks[i].className.replace(" active", "");
			}
			document.getElementById(tabName).style.display = "block";
			evt.currentTarget.className += " active";
		}
		// Get the element with id="defaultOpen" and click on it
		document.getElementById("defaultOpenTab").click();

		/*-------------------------------------------------*/
	</script>
</body>

</html>